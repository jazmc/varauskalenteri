<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<!-- CSS only -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU"
	crossorigin="anonymous">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Anonymous+Pro&family=Patrick+Hand+SC&display=swap" rel="stylesheet">
<link type="text/css" rel="stylesheet" href="css/css.css" th:href="@{css/css.css}" />
<script src="https://kit.fontawesome.com/7e7cff31ed.js"
	crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.5.0.js"></script>

<head>
<title>Varauskalenteri</title>
</head>
<body>
	<div class="ylaosa">
	<h1 th:inline="text">LENTOVARAUSKALENTERI</h1>
	<form th:action="@{/logout}" method="post">
		<input type="submit" class="btn btn-outline-light btn-sm" value="Kirjaudu ulos" />
	</form>
	<br>
	<br>
	<p th:text="${#dates.format(#dates.createNow(),'YYYY/MM/dd HH:mm')}">Tekstiä</p>

	</div>

	<div class="kalenteripohja">
		<table class="varauspohja">
			<tr class="stay">
				<th>Päivä</th>
				<td class="flex">
					<div th:each="i : ${#numbers.sequence(0, 23, 1)}"
						th:text="${#numbers.formatInteger(i,2)}"></div>
				</td>
			</tr>
			<tr th:each="i : ${#numbers.sequence(1, vikapv, 1)}"
				th:class="${#temporals.dayOfWeek(kkeka.plusDays(i-1))==7} ? 'sunnuntai'"
				th:id="${#dates.format(#dates.createNow(),'YYYY') eq #temporals.format(kkeka, 'YYYY') and #dates.format(#dates.createNow(),'MM') eq #temporals.format(kkeka, 'MM') and #dates.format(#dates.createNow(),'dd') eq #numbers.formatInteger(i,2)} ? 'tanaan'">
				<td class="stay"
					th:switch="${#temporals.dayOfWeek(kkeka.plusDays(i-1))}"><span
					th:case="1">Maanantai</span><span th:case="2">Tiistai</span><span
					th:case="3">Keskiviikko</span><span th:case="4">Torstai</span><span
					th:case="5">Perjantai</span><span th:case="6">Lauantai</span><span
					th:case="7">Sunnuntai</span>
					<div class="pvanro"
						th:text="@{${#numbers.formatInteger(i,2)} + '.' + ${#temporals.month(kkeka)} + '.'}"></div>
				</td>
				<td th:class="${i%2==0} ? 'flex parillinen' : 'flex pariton'"><div class="tunti" th:each="j : ${#numbers.sequence(0, 23, 1)}"
						th:id="@{${#temporals.year(kkeka)} + '/' + ${#temporals.month(kkeka)} + '/' + ${#numbers.formatInteger(i,2)} + '/' + ${#numbers.formatInteger(j,2)}}"><th:block th:each="varaus: ${varaukset}"><div th:attr="rel=${varaus.id}, data-varaaja=${varaus.user.id}" th:class="${#strings.toLowerCase(varaus.kategoria.name)}"
								th:if="${#temporals.format(kkeka, 'MM') == #temporals.format(varaus.alku, 'MM') and #numbers.formatInteger(j,2) eq #temporals.format(varaus.alku, 'HH') and #numbers.formatInteger(i,2) eq #temporals.format(varaus.alku, 'dd')}"
								th:text="@{${varaus.kategoria.name == 'Huolto'} ? 'HUOLTO ' : ${varaus.user.sukunimi} + ', ' + ${varaus.user.etunimi}}"
								th:style="${#temporals.format(varaus.alku, 'mm') eq '30'} ? 'margin-left:50%;width:calc('+${varaus.kesto}+' * (100% + 1px));' : 'width:calc('+${varaus.kesto}+' * (100% + 1px));'"></div><div th:attr="rel=${varaus.id}, data-varaaja=${varaus.user.id}" th:class="${#strings.toLowerCase(varaus.kategoria.name)}"
								th:if="${#temporals.format(kkeka, 'MM') == #temporals.format(varaus.alku, 'MM') and #temporals.day(varaus.alku) < i and #temporals.day(varaus.loppu) > i and j == 0}"
								th:text="@{${varaus.kategoria.name == 'Huolto'} ? 'HUOLTO (jatkuu) ' : ${varaus.user.sukunimi} + ', ' + ${varaus.user.etunimi} + ' (jatkuu)'}"
								th:style="'width:calc('+${varaus.kesto}+' * (100% + 1px)); border-top-left-radius:0; border-bottom-left-radius:0;'"></div><div th:attr="rel=${varaus.id}, data-varaaja=${varaus.user.id}" th:class="${#strings.toLowerCase(varaus.kategoria.name)}"
								th:if="${#temporals.format(kkeka, 'MM') == #temporals.format(varaus.alku, 'MM') and #temporals.day(varaus.alku) < i and #temporals.day(varaus.loppu) == i and #numbers.formatInteger(j,2) eq #temporals.format(varaus.loppu, 'HH')}"
								th:text="@{${varaus.kategoria.name == 'Huolto'} ? 'HUOLTO (päättyy)' : ${varaus.user.sukunimi} + ', ' + ${varaus.user.etunimi} + ' (päättyy)'}"
								th:style="${#temporals.format(varaus.loppu, 'mm') eq '30'} ? 'margin-right:-50%;width:calc('+${varaus.kesto}+' * (100% + 1px)); left:unset; right:100%; text-align:right;' : 'width:calc('+${varaus.kesto}+' * (100% + 1px)); left:unset; right:100%; text-align:right;'"></div></th:block></div></td>
			</tr>
		</table>
	</div>
	<footer>webdesign &copy; Jasmin Lumme</footer>

	<script>
		$('.huolto').css('background-color', '#baa29d');
		
		$('.lentovaraus').each(function(){
			var varijono = ['#A8FFF6', '#DAB5FF', '#ffb593', '#b3f0c8', '#FFE1B5', '#FFC4A8', '#DAB5FF', '#8FFFF4', '#9CFFBD'];
			var varaajanid = $(this).attr("data-varaaja");
			$(this).css('background-color', varijono[varaajanid]);
		});
		
		$('.lentovaraus, .huolto').mouseover(function() {
			var varauksenid = $(this).attr("rel");
			$('div[rel='+varauksenid+']').css('opacity', '1');
		});
		
		$('.lentovaraus, .huolto').mouseout(function() {
			var varauksenid = $(this).attr("rel");
			$('div[rel='+varauksenid+']').css('opacity', '.9');
		});

		$('.lentovaraus, .huolto').click(function() {
			var varauksenid = $(this).attr("rel");
			haeVaraus(varauksenid);
		});

		$('.muokkaa').not('.spessu').click(
				function() {
					var asia = $(this).attr('rel');
					var id = $(this).attr('name');
					var value = $('#' + asia + id).attr('contenteditable');

					if (value == "false") {
						$("#" + asia + id).attr('contenteditable', 'true');
						$("span").not("#" + asia + id).attr('contenteditable',
								'false');
						$(this).html('<i class="far fa-save"></i>');
						$('.muokkaa').not(this).html(
								'<i class="far fa-edit"></i>');
					} else {
						var arvo = $("#" + asia + id).text();
						window.location.href = '/edit/' + id + '/' + asia + '/'
								+ arvo;
					}
				});
		$('.spessu').click(
				function() {

					var asia = $(this).attr('rel');
					var id = $(this).attr('name');
					var value = $(this).html();

					if (value.indexOf("edit") > 0) {
						$("#catlist" + id).css("display", "inline-block");
						$("#category" + id).hide();
						$(this).html('<i class="far fa-save"></i>');
					} else {
						var arvo = $("#catlist" + id).val();
						if (arvo != "" && arvo != null) {
							window.location.href = '/edit/' + id + '/' + asia
									+ '/' + arvo;
						}
					}

				});
		function haeVaraus(id) {
			$.ajax({
			    url: "/varaukset/"+id,
			    type: "GET",
			    dataType: "json",
			    data: {},
			    success: function(data){
			    	alert("Onnistui! Varauksen tiedot consolessa.");
			        console.log(data);
			    },
			    error: function(error){
			         alert("Error, errorin kuvaus consolessa");
			         console.log(error);
			    }
			});
		}
	</script>
</body>
</html>